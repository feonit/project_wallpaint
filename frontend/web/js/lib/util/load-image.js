/*! wallpaint - v0.0.1 - 2013-11-26 */(function(e){"use strict";var t=function(e,i,n){var s,o,a=document.createElement("img");return a.onerror=i,a.onload=function(){!o||n&&n.noRevoke||t.revokeObjectURL(o),i(t.scale(a,n))},window.Blob&&e instanceof Blob||window.File&&e instanceof File?(s=o=t.createObjectURL(e),a._type=e.type):"string"==typeof e&&(s=e),s?(a.src=s,a):t.readFile(e,function(e){var t=e.target;t&&t.result?a.src=t.result:i(e)})},i=window.createObjectURL&&window||window.URL&&URL.revokeObjectURL&&URL||window.webkitURL&&webkitURL;t.detectSubsampling=function(e){var t,i,n=e.width,s=e.height;return n*s>1048576?(t=document.createElement("canvas"),t.width=t.height=1,i=t.getContext("2d"),i.drawImage(e,-n+1,0),0===i.getImageData(0,0,1,1).data[3]):!1},t.detectVerticalSquash=function(e,t){var i,n,s,o,a,r=document.createElement("canvas"),l=r.getContext("2d");for(r.width=1,r.height=t,l.drawImage(e,0,0),i=l.getImageData(0,0,1,t).data,n=0,s=t,o=t;o>n;)a=i[4*(o-1)+3],0===a?s=o:n=o,o=s+n>>1;return o/t||1},t.renderImageToCanvas=function(e,i,n,s){var o,a,r,l,h,c,u,d,p=e.width,f=e.height,m=i.getContext("2d"),g=1024,v=document.createElement("canvas");for(m.save(),t.detectSubsampling(e)&&(p/=2,f/=2),o=t.detectVerticalSquash(e,f),v.width=v.height=g,a=v.getContext("2d"),r=Math.ceil(g*n/p),l=Math.ceil(g*s/f/o),c=0,d=0;f>d;){for(h=0,u=0;p>u;)a.clearRect(0,0,g,g),a.drawImage(e,-u,-d),m.drawImage(v,0,0,g,g,h,c,r,l),u+=g,h+=r;d+=g,c+=l}m.restore(),v=a=null},t.scale=function(e,i){i=i||{};var n=document.createElement("canvas"),s=e.width,o=e.height,a=Math.max((i.minWidth||s)/s,(i.minHeight||o)/o);return a>1&&(s=Math.ceil(s*a),o=Math.ceil(o*a)),a=Math.min((i.maxWidth||s)/s,(i.maxHeight||o)/o),1>a&&(s=Math.ceil(s*a),o=Math.ceil(o*a)),e.getContext||i.canvas&&n.getContext?(n.width=s,n.height=o,"image/jpeg"===e._type?t.renderImageToCanvas(e,n,s,o):n.getContext("2d").drawImage(e,0,0,s,o),n):(e.width=s,e.height=o,e)},t.createObjectURL=function(e){return i?i.createObjectURL(e):!1},t.revokeObjectURL=function(e){return i?i.revokeObjectURL(e):!1},t.readFile=function(e,t){if(window.FileReader&&FileReader.prototype.readAsDataURL){var i=new FileReader;return i.onload=i.onerror=t,i.readAsDataURL(e),i}return!1},"function"==typeof define&&define.amd?define(function(){return t}):e.loadImage=t})(this);